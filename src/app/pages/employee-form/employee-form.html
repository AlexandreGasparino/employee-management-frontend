<div class="container mt-4">
  <h3 class="mb-3">
    {{ isEdit ? 'Editar Funcionário' : 'Novo Funcionário' }}
  </h3>

  <div *ngIf="loading" class="alert alert-info">Carregando...</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <form (ngSubmit)="submit()" *ngIf="!loading">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">Nome</label>
        <input class="form-control" [(ngModel)]="form.firstName" name="firstName" required />
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label">Sobrenome</label>
        <input class="form-control" [(ngModel)]="form.lastName" name="lastName" required />
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label">E-mail</label>
        <input type="email" class="form-control" [(ngModel)]="form.email" name="email" required />
      </div>
      <div class="col-md-3 mb-3">
        <label class="form-label">Documento</label>
        <input class="form-control" [(ngModel)]="form.docNumber" name="docNumber" required />
      </div>
      <div class="col-md-3 mb-3">
        <label class="form-label">Data de Nascimento</label>
        <input type="date" class="form-control" [(ngModel)]="form.birthDate" name="birthDate" required />
      </div>
    </div>

    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Cargo</label>
        <select class="form-select" [(ngModel)]="form.role" name="role">
          <option *ngFor="let r of roles" [ngValue]="r.value">{{ r.label }}</option>
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">Manager Id (Opcional)</label>
        <input class="form-control" [(ngModel)]="form.managerId" name="managerId" />
      </div>
      <div class="col-md-4 mb-3" *ngIf="!isEdit">
        <label class="form-label">Senha</label>
        <input type="password" class="form-control" [(ngModel)]="form.password" name="password" required />
      </div>
    </div>

    <h5 class="mt-3">Telefones</h5>
    <div *ngFor="let phone of form.phones; let i = index" class="row align-items-end mb-2">
      <div class="col-md-5">
        <label class="form-label">Número</label>
        <input class="form-control" [(ngModel)]="phone.number" [name]="'phone_number_' + i" required />
      </div>
      <div class="col-md-5">
        <label class="form-label">Tipo</label>
        <select class="form-select" [(ngModel)]="phone.type" [name]="'phone_type_' + i">
          <option value="Mobile">Mobile</option>
          <option value="Home">Home</option>
          <option value="Work">Work</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="button" class="btn btn-outline-danger mt-4" (click)="removePhone(i)" [disabled]="form.phones.length === 1">
          Remover
        </button>
      </div>
    </div>

    <button type="button" class="btn btn-outline-secondary mb-3" (click)="addPhone()">
      Adicionar Telefone
    </button>

    <div class="mt-3">
      <button class="btn btn-primary me-2" [disabled]="saving">
        {{ saving ? 'Salvando...' : 'Salvar' }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="cancel()">Cancelar</button>
    </div>
  </form>
</div>